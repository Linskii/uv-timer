<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sun Calculator Project</title>
</head>
<body>
    <h1>Sun Calculator Project Page</h1>
    <p>If you can see this, the project page is working correctly!</p>

    <button id="locationBtn">Get My Location</button>
    <p id="locationInfo"></p>
    <p id="uvInfo"></p>


    <div>
        <label for="skinTypeSelect">Select your skin type:</label>
        <select name="skin-type" id="skinTypeSelect">
            <option value="1">Type 1 (Very fair, always burns, never tans)</option>
            <option value="2">Type 2 (Fair, usually burns, tans with difficulty)</option>
            <option value="3">Type 3 (Fair to beige, sometimes burns, tans gradually)</option>
            <option value="4">Type 4 (Light brown, rarely burns, tans with ease)</option>
            <option value="5">Type 5 (Brown, very rarely burns, tans very easily)</option>
            <option value="6">Type 6 (Dark brown to black, never burns, tans very easily)</option>
        </select>
    </div>

    <div>
        <label for="spfSelect">Select your sunscreen (LSF):</label>
        <select name="spf" id="spfSelect">
            <option value="1">No sunscreen</option>
            <option value="10">LSF 10</option>
            <option value="20">LSF 20</option>
            <option value="30">LSF 30</option>
            <option value="40">LSF 40</option>
            <option value="50">LSF 50</option>
        </select>
    </div>

    <button id="calculateBtn">Calculate Sun Time</button>
    <p id="sunTimeResult"></p>


    <script>
        const locationBtn = document.getElementById("locationBtn");
        const locationInfo = document.getElementById("locationInfo");
        const uvInfo = document.getElementById("uvInfo");
        const skinTypeSelect = document.getElementById("skinTypeSelect");
        const spfSelect = document.getElementById("spfSelect");
        const calculateBtn = document.getElementById("calculateBtn");
        const sunTimeResult = document.getElementById("sunTimeResult");
    
        
        const apiKey = "c5965e1bc65e4ae2bff60e9df7350176"; // <-- IMPORTANT: Replace with your Weatherbit API key
        let currentUVIndex = 0; // Variable to store the UV index

        // Self-protection times in minutes for each skin type
        const selfProtectionTimes = {
            "1": 10,
            "2": 15,
            "3": 20,
            "4": 30,
            "5": 45,
            "6": 60
        };


        locationBtn.addEventListener("click", () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                locationInfo.innerHTML = "Geolocation is not supported by this browser.";
            }
        });

        calculateBtn.addEventListener("click", () => {
            const skinType = skinTypeSelect.value;
            const spf = spfSelect.value;
            const selfProtectionTime = selfProtectionTimes[skinType];

            if (currentUVIndex > 0) {
                const maxSunTime = (selfProtectionTime * spf) / currentUVIndex;
                sunTimeResult.innerHTML = `You can stay in the sun for approximately ${Math.round(maxSunTime)} minutes.`;
            } else {
                sunTimeResult.innerHTML = "Please get the current UV index first.";
            }
        });



        function getUVIndex(lat, lon) {
            const apiUrl = `https://api.weatherbit.io/v2.0/forecast/daily?lat=${lat}&lon=${lon}&key=${apiKey}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    // Extract city, country, and UV index from the response
                    const cityName = data.city_name;
                    const countryCode = data.country_code;
                    const uvIndex = data.data[0].uv;
                    currentUVIndex = uvIndex; // Store the UV index

                    // Add city and country to the location info for a sanity check
                    locationInfo.innerHTML += `<br>Location: ${cityName}, ${countryCode}`;
                    
                    // Display the UV index for the current day
                    uvInfo.innerHTML = "UV Index for today: " + uvIndex;
                })
                .catch(error => {
                    uvInfo.innerHTML = "Failed to fetch UV index.";
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            locationInfo.innerHTML = "Latitude: " + lat +
                                     "<br>Longitude: " + lon;
            // Call getUVIndex after getting the position
            getUVIndex(lat, lon);
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    locationInfo.innerHTML = "User denied the request for Geolocation."
                    break;
                case error.POSITION_UNAVAILABLE:
                    locationInfo.innerHTML = "Location information is unavailable."
                    break;
                case error.TIMEOUT:
                    locationInfo.innerHTML = "The request to get user location timed out."
                    break;
                case error.UNKNOWN_ERROR:
                    locationInfo.innerHTML = "An unknown error occurred."
                    break;
            }
        }
    </script>
</body>
</html>