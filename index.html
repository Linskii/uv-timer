<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sun Calculator Project</title>
</head>
<body>
    <h1>Wie lange kann ich in der Sonne bleiben? </h1>

    <button id="locationBtn">Aktuelle Position bestimmen</button>
    <p id="locationInfo"></p>
    <p id="uvInfo"></p>


    <div>
        <label for="skinTypeSelect">Wählen Sie Ihren Hauttyp:</label>
        <select name="skin-type" id="skinTypeSelect">
            <option value="1">Typ 1 (Sehr hell, immer Sonnenbrand, bräunt nie)</option>
            <option value="2">Typ 2 (Hell, meistens Sonnenbrand, bräunt langsam)</option>
            <option value="3">Typ 3 (Hell bis beige, manchmal Sonnenbrand, bräunt allmählich)</option>
            <option value="4">Typ 4 (Hellbraun, selten Sonnenbrand, bräunt leicht)</option>
            <option value="5">Typ 5 (Braun, sehr selten Sonnenbrand, bräunt sehr leicht)</option>
            <option value="6">Typ 6 (Dunkelbraun bis schwarz, nie Sonnenbrand, bräunt sehr leicht)</option>
        </select>
    </div>

    <div>
        <label for="spfSelect">Wählen Sie Ihren Sonnenschutz (LSF):</label>
        <select name="spf" id="spfSelect">
            <option value="1">Kein Sonnenschutz</option>
            <option value="10">LSF 10</option>
            <option value="20">LSF 20</option>
            <option value="30">LSF 30</option>
            <option value="40">LSF 40</option>
            <option value="50">LSF 50</option>
        </select>
    </div>

    <button id="calculateBtn">Sonnenzeit ausrechnen</button>
    <p id="sunTimeResult"></p>


    <script>
        const locationBtn = document.getElementById("locationBtn");
        const locationInfo = document.getElementById("locationInfo");
        const uvInfo = document.getElementById("uvInfo");
        const skinTypeSelect = document.getElementById("skinTypeSelect");
        const spfSelect = document.getElementById("spfSelect");
        const calculateBtn = document.getElementById("calculateBtn");
        const sunTimeResult = document.getElementById("sunTimeResult");
    
        
        const apiKey = "c5965e1bc65e4ae2bff60e9df7350176"; // <-- IMPORTANT: Replace with your Weatherbit API key
        let currentUVIndex = 0; // Variable to store the UV index

        // Self-protection times in minutes for each skin type
        const selfProtectionTimes = {
            "1": 10,
            "2": 15,
            "3": 20,
            "4": 30,
            "5": 45,
            "6": 60
        };


        locationBtn.addEventListener("click", () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                locationInfo.innerHTML = "Geolocation is not supported by this browser.";
            }
        });

        calculateBtn.addEventListener("click", () => {
            const skinType = skinTypeSelect.value;
            const spf = spfSelect.value;
            const selfProtectionTime = selfProtectionTimes[skinType];

            if (currentUVIndex > 0) {
                const maxSunTime = (selfProtectionTime * spf) / currentUVIndex;
                sunTimeResult.innerHTML = `Du kannst für ungefähr ${Math.round(maxSunTime)} minuten in der Sonne bleiben.`;
            } else {
                sunTimeResult.innerHTML = "Bitte bestimme zuerst den aktuellen maximalen UV index anhand deiner Position.";
            }
        });



        function getUVIndex(lat, lon) {
            const apiUrl = `https://api.weatherbit.io/v2.0/forecast/daily?lat=${lat}&lon=${lon}&key=${apiKey}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    // Extract city, country, and UV index from the response
                    const cityName = data.city_name;
                    const countryCode = data.country_code;
                    const uvIndex = data.data[0].uv;
                    currentUVIndex = uvIndex; // Store the UV index

                    // Add city and country to the location info for a sanity check
                    locationInfo.innerHTML += `<br>Ort: ${cityName}, ${countryCode}`;
                    
                    // Display the UV index for the current day
                    uvInfo.innerHTML = "Heutiger maximaler UV index: " + uvIndex;
                })
                .catch(error => {
                    uvInfo.innerHTML = "Failed to fetch UV index.";
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            locationInfo.innerHTML = "Breitengrad: " + lat +
                                     "<br>Längengrad: " + lon;
            // Call getUVIndex after getting the position
            getUVIndex(lat, lon);
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    locationInfo.innerHTML = "User denied the request for Geolocation."
                    break;
                case error.POSITION_UNAVAILABLE:
                    locationInfo.innerHTML = "Location information is unavailable."
                    break;
                case error.TIMEOUT:
                    locationInfo.innerHTML = "The request to get user location timed out."
                    break;
                case error.UNKNOWN_ERROR:
                    locationInfo.innerHTML = "An unknown error occurred."
                    break;
            }
        }
    </script>
</body>
</html>