<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sun Calculator Project</title>
</head>
<body>
    <h1>Sun Calculator Project Page</h1>
    <p>If you can see this, the project page is working correctly!</p>

    <button id="locationBtn">Get My Location</button>
    <p id="locationInfo"></p>
    <p id="uvInfo"></p>



    <script>
        const locationBtn = document.getElementById("locationBtn");
        const locationInfo = document.getElementById("locationInfo");
        const uvInfo = document.getElementById("uvInfo");
        const apiKey = "c5965e1bc65e4ae2bff60e9df7350176"; // <-- IMPORTANT: Replace with your Weatherbit API key

        locationBtn.addEventListener("click", () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                locationInfo.innerHTML = "Geolocation is not supported by this browser.";
            }
        });


        function getUVIndex(lat, lon) {
            const apiUrl = `https://api.weatherbit.io/v2.0/forecast/daily?lat=${lat}&lon=${lon}&key=${apiKey}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    // Extract city, country, and UV index from the response
                    const cityName = data.city_name;
                    const countryCode = data.country_code;
                    const uvIndex = data.data[0].uv;

                    // Add city and country to the location info for a sanity check
                    locationInfo.innerHTML += `<br>Location: ${cityName}, ${countryCode}`;
                    
                    // Display the UV index for the current day
                    uvInfo.innerHTML = "UV Index for today: " + uvIndex;
                })
                .catch(error => {
                    uvInfo.innerHTML = "Failed to fetch UV index.";
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            locationInfo.innerHTML = "Latitude: " + lat +
                                     "<br>Longitude: " + lon;
            // Call getUVIndex after getting the position
            getUVIndex(lat, lon);
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    locationInfo.innerHTML = "User denied the request for Geolocation."
                    break;
                case error.POSITION_UNAVAILABLE:
                    locationInfo.innerHTML = "Location information is unavailable."
                    break;
                case error.TIMEOUT:
                    locationInfo.innerHTML = "The request to get user location timed out."
                    break;
                case error.UNKNOWN_ERROR:
                    locationInfo.innerHTML = "An unknown error occurred."
                    break;
            }
        }
    </script>
</body>
</html>